From 63d3d783562d28e16afcfc1a75707c09e1457a30 Mon Sep 17 00:00:00 2001
From: MerCuJerry <mercujerry@gmail.com>
Date: Sun, 4 Jan 2026 09:20:13 +0800
Subject: [PATCH] susfs_patch_newuname

---
 kernel/sys.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/kernel/sys.c b/kernel/sys.c
index b4862260a924..85fbf7fa30c1 100644
--- a/kernel/sys.c
+++ b/kernel/sys.c
@@ -1185,12 +1185,18 @@ static int override_release(char __user *release, size_t len)
 	return ret;
 }
 
+#ifdef CONFIG_KSU_SUSFS_SPOOF_UNAME
+extern void susfs_spoof_uname(struct new_utsname* tmp);
+#endif
 SYSCALL_DEFINE1(newuname, struct new_utsname __user *, name)
 {
 	struct new_utsname tmp;
 
 	down_read(&uts_sem);
 	memcpy(&tmp, utsname(), sizeof(tmp));
+#ifdef CONFIG_KSU_SUSFS_SPOOF_UNAME
+	susfs_spoof_uname(&tmp);
+#endif
 	if (!strncmp(current->comm, "bpfloader", 9) ||
 	    !strncmp(current->comm, "netd", 4)) {
 		strcpy(tmp.release, "4.19.0");
-- 
2.52.0

